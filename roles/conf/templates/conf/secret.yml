apiVersion: v1
kind: Secret
metadata:
  name: env-secrets
  namespace: "{{ ansible_operator_meta.namespace }}"
data:
  SENTRY_URL: {{ appSecrets.sentryUrl | b64encode }}
  POSTGRES_DB: {{ pg.dbname | b64encode }}
  POSTGRES_PASSWORD: {{ pg.pass | b64encode }}
  POSTGRES_USER: {{ pg.user | b64encode }}
  POSTGRES_HOST: {{ pg.svcName | b64encode }}
  SECRET_KEY_BASE: {{ appSecrets.secretKeyBase | b64encode }}
  STS_IV: {{ appSecrets.stsIv | b64encode }}
  STS_KEY: {{ appSecrets.stsKey | b64encode }}
  REDIS_URL: {{ ('redis://'+redis.svcName) | b64encode}}
  PASSENGER_APP_ENV: {{ appSecrets.passengerAppEnv | b64encode }}
  RAILS_ENV: {{ appSecrets.railsEnv | b64encode }}
  RUN_JOBS_ON_SELF_CLUSTER: {{ appSecrets.runJobsOnSelfCluster | b64encode }}
  DEFAULT_COMPUTE_CONFIG: {{ appSecrets.defaultComputeConfig | b64encode }}
  DEFAULT_COMPUTE_NAME: {{ appSecrets.defaultComputeName | b64encode }}

  USE_STDOUT: {{ appSecrets.useStdout | b64encode }}
  EXTRACT_TAGS_FROM_CMD: {{ appSecrets.extractTagsFromCmd | b64encode }}
  CHECK_JOB_EXPIRATION: {{ appSecrets.checkJobExpiration | b64encode }}

  ################## shared storage configs  ###########################
  CNVRG_STORAGE_TYPE: {{ appSecrets.cnvrgStorageType | b64encode }}

  ################## minio  ###########################
  MINIO_SSE_MASTER_KEY: {{ appSecrets.minioSseMasterKey | b64encode }}
  CNVRG_STORAGE_ENDPOINT: {{ appSecrets.cnvrgStorageEndpoint | b64encode }}

  ################## minio/aws storage configs  ###########################
  CNVRG_STORAGE_BUCKET: {{ appSecrets.cnvrgStorageBucket | b64encode }}
  CNVRG_STORAGE_ACCESS_KEY:  {{ appSecrets.cnvrgStorageAccessKey | b64encode }}
  CNVRG_STORAGE_SECRET_KEY: {{ appSecrets.cnvrgStorageSecretKey | b64encode }}
  CNVRG_STORAGE_REGION: {{ appSecrets.cnvrgStorageRegion | b64encode }}

  ################## azure #########################
  CNVRG_STORAGE_AZURE_ACCESS_KEY: {{ appSecrets.cnvrgStorageAzureAccessKey | b64encode }}
  CNVRG_STORAGE_AZURE_ACCOUNT_NAME: {{ appSecrets.cnvrgStorageAzureAccountName | b64encode }}
  CNVRG_STORAGE_AZURE_CONTAINER: {{ appSecrets.cnvrgStorageAzureContainer | b64encode }}

  ################## gcp ###########################
  CNVRG_STORAGE_KEYFILE: {{ (conf.gcpKeyfileMountPath + '/'+ conf.gcpKeyfileName) | b64encode }}
  CNVRG_STORAGE_PROJECT: {{ appSecrets.cnvrgStorageProject | b64encode }}

  APP_DOMAIN: {{ ((cnvrgApp.svcName + '.' if networking.ingressType != 'nodeport' else '') + clusterDomain + (':'+cnvrgApp.nodePort|string if networking.ingressType == 'nodeport' else '')) | b64encode }}
  DEFAULT_URL: {{(httpScheme + (cnvrgApp.svcName + '.' if networking.ingressType != 'nodeport' else '') + clusterDomain + (':'+cnvrgApp.nodePort|string if networking.ingressType == 'nodeport' else '')) | b64encode }}
  DEFAULT_COMPUTE_CLUSTER_DOMAIN: {{ (clusterDomain + (':'+cnvrgApp.nodePort|string if networking.ingressType == 'nodeport' else '')) | b64encode }}
  DEFAULT_COMPUTE_CLUSTER_HTTPS: {{ networking.https.enabled | b64encode }}
