- name: Debug - {{ template_path }}
  debug:
    msg: "State for {{ template_path }} : {{ state }}"
  tags: always

- name: Debug - {{ template_path }}
  debug:
    msg: "{{ lookup('template', '{{ template_path }}') }}"
  when: debug == "true"
  tags: always

- name: Template a file to /tmp
  template:
    src: "{{ template_path }}"
    dest: "{{ dump_dir }}/{{ template_path.replace('/','_') }}"
  when: dump_dir != ""

# Set default value of "no" for K8S wait moduel,when wait_to_complete is not defined
# https://docs.ansible.com/ansible/latest/collections/community/kubernetes/k8s_module.html#parameter-wait
- name: Set wait flag
  set_fact:
    wait_to_complete: no
  when: wait_to_complete is not defined
  tags: always

# Set default value of "no" for compare_resource , when compare_resource is not defined
# https://docs.ansible.com/ansible/latest/collections/community/kubernetes/k8s_module.html#parameter-apply
- name: Set apply flag
  set_fact:
    compare_resource: no
  when: compare_resource is not defined
  tags: always

- name: Create - {{ template_path }}
  k8s:
    state: "{{state}}"
    definition: "{{ lookup('template', '{{ template_path }}') }}"
    wait: "{{wait_to_complete|bool}}"
    apply: "{{compare_resource|bool}}"
  when: dry_run == "false"
  tags: always