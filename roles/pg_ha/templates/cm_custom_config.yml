apiVersion: v1
kind: ConfigMap
metadata:
  name: postgres-custom-config
  namespace: "{{ansible_operator_meta.namespace}}"
data:
  postgres-ha.yaml: |-
    bootstrap:
      dcs:
        postgresql:
          parameters:
            max_connections: 500
            shared_buffers: 2GB
            temp_buffers: 10MB
            work_mem: 5MB
    postgresql:
      pg_hba:
        - local all postgres peer
        - local all {{ pg.user }} peer
        - local all crunchyadm peer
        - host replication primaryuser 0.0.0.0/0 md5
        - host all primaryuser 0.0.0.0/0 reject
        - host all postgres 0.0.0.0/0 md5
        - host all {{ pg.user }} 0.0.0.0/0 md5
