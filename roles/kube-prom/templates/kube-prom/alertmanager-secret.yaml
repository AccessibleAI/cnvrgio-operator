apiVersion: v1
kind: Secret
metadata:
  name: alertmanager-main
  namespace: "{{ansible_operator_meta.namespace}}"
type: Opaque
stringData:
  alertmanager.yaml: |+
    "global":
      "resolve_timeout": "5m"
    "route":
      "group_by":
      - "namespace"
      "group_interval": "5m"
      "group_wait": "3m"
      "receiver": "blackhole"
      "repeat_interval": "12h"
      "routes":
      - "match":
          "cnvrg": "custom"
        "receiver": "slack-notifications"
      - "match":
          "alertname": "Watchdog"
        "receiver": "Watchdog"
    "receivers":
    - "name": "blackhole"
    - "name": "Watchdog"
      "slack_configs":
      - "api_url": "{{ 'aHR0cHM6Ly9ob29rcy5zbGFjay5jb20vc2VydmljZXMvVDA2M1hSRTJIL0IwMThNQjhQR1NLL0RoeVREMEt6ZnFsYlB3NTg2eXdCcmF2NA==' | b64decode }}"
        "channel": "#slack-watchdog"
        "send_resolved": "true"
        "icon_url": "https://avatars3.githubusercontent.com/u/3380462"
        "text": "not working"
    - "name": "slack-notifications"
      "slack_configs":
      - "api_url": "{{ 'aHR0cHM6Ly9ob29rcy5zbGFjay5jb20vc2VydmljZXMvVDA2M1hSRTJIL0IwMTkyM1A0NUVFL09iczVWRGlkU1lsVEJ0RzJHak9vWGoyWQ==' | b64decode }}"
        "channel": "{{ alertmanager.channel }}"
        "send_resolved": "true"
        "icon_url": "https://avatars3.githubusercontent.com/u/3380462"
        "text": >+
          {{ '{{' }} range .Alerts {{ '}}' }}
          {{ '{{' }} if .Annotations.summary {{ '}}' }} *Summary:* `{{ '{{' }} .Annotations.summary {{ '}}' }}`{{ '{{' }} end {{ '}}' }}
          *Description:* {{ '{{' }} .Annotations.description {{ '}}' }}

          *Details:*
            {{ '{{' }} range .Labels.SortedPairs {{ '}}' }} â€¢ *{{ '{{' }} .Name {{ '}}' }}:* `{{ '{{' }} .Value {{ '}}' }}`
            {{ '{{' }} end {{ '}}' }}

          {{ '{{' }} end {{ '}}' }}