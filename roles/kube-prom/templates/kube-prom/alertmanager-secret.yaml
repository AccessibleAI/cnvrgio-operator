apiVersion: v1
kind: Secret
metadata:
  name: "{{ alertmanager.svc_name }}"
  namespace: "{{ansible_operator_meta.namespace}}"
type: Opaque
stringData:
  alertmanager.yaml: |+
    "global":
      "resolve_timeout": "5m"
    "route":
      "group_by":
      - "alertname"
      "group_interval": "5m"
      "group_wait": "1m"
      "receiver": "blackhole"
      "repeat_interval": "12h"
      "routes":
      - "match":
          "cnvrg": "custom"
        "receiver": "slack-notifications"
      - "match":
          "alertname": "Watchdog"
        "receiver": "Watchdog"
    "receivers":
    - "name": "blackhole"
    - "name": "Watchdog"
      "slack_configs":
      - "api_url": "{{ slack_url }}"
        "channel": "#slack-watchdog"
        "send_resolved": true
        "icon_url": "https://avatars3.githubusercontent.com/u/3380462"
        "text": "watchdog alert"
        "title": "Coming from domain : {{ cluster_domain }}"
    - "name": "slack-notifications"
      "slack_configs":
      - "api_url": "{{ slack_url }}"
        "channel": "{{ alertmanager.slack_channel }}"
        "send_resolved": true
        "title": "Coming from domain : {{ cluster_domain }}"
        "icon_url": "https://avatars3.githubusercontent.com/u/3380462"
        "text": >+
          {{ '{{' }} range .Alerts {{ '}}' }}
          {{ '{{' }} if .Annotations.summary {{ '}}' }} *Summary:* `{{ '{{' }} .Annotations.summary {{ '}}' }}`{{ '{{' }} end {{ '}}' }}
          *Description:* {{ '{{' }} .Annotations.description {{ '}}' }}

          *Details:*
            {{ '{{' }} range .Labels.SortedPairs {{ '}}' }} â€¢ *{{ '{{' }} .Name {{ '}}' }}:* `{{ '{{' }} .Value {{ '}}' }}`
            {{ '{{' }} end {{ '}}' }}

          {{ '{{' }} end {{ '}}' }}