apiVersion: networking.istio.io/v1alpha3
kind: VirtualService
metadata:
  name: "{{cnvrg_app.svc_name}}"
  namespace: "{{ansible_operator_meta.namespace}}"
spec:
  hosts:
    - "{{ (cnvrg_app.svc_name + '.' + cluster_domain).split(':')[0] }}"
  gateways:
    - "{{istio.gw_name}}"
  http:
    - timeout: 4020s
      retries:
        attempts: 10
        perTryTimeout: 4020s
      match:
        - uri:
            prefix: /cable
      route:
        - destination:
            host: "{{cnvrg_app.svc_name + '.' + ansible_operator_meta.namespace + ".svc.cluster.local" }}"
    - timeout: 4020s
      retries:
        attempts: 10
        perTryTimeout: 4020s
      route:
        - destination:
            host: "{{cnvrg_app.svc_name + '.' + ansible_operator_meta.namespace + ".svc.cluster.local" }}"