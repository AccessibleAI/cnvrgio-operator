apiVersion: networking.istio.io/v1alpha3
kind: VirtualService
metadata:
  name: "{{prometheus.svc_name}}"
  namespace: "{{ansible_operator_meta.namespace}}"
spec:
  hosts:
  - "{{ (prometheus.svc_name + '.' + cluster_domain).split(':')[0] }}"
  gateways:
  - "{{istio.gw_name}}"
  http:
  - timeout: 50s
    retries:
      attempts: 4
      perTryTimeout: 30s
    route:
    - destination:
        port:
          number: {{prometheus.port}}
        host: "{{prometheus.svc_name +'.' + ansible_operator_meta.namespace + ".svc.cluster.local" }}"